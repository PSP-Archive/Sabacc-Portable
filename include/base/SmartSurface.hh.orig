#ifndef __SMF_SMART_SURFACE_HH
#define __SMF_SMART_SURFACE_HH

/*
 * Sabacc Media Framework
 *
 * Author: Anthony Thomasel
 * Date: August 27, 2008
 *
 * File: SmartSurface.hh
 *
 * A class to assist with proper allocation of surfaces,
 * in attempt to avoid double frees and the like.
 */

// SDL headers
#if defined(__APPLE__)
#include <SDL/SDL.h>
#else
#include <SDL.h>
#endif

class SmartSurface {

public:

    explicit SmartSurface(SDL_Surface* p = 0) : pointer_data(0) {
        if (p) pointer_data = new PointerData(p);
    }	// SmartSurface

    ~SmartSurface();
    SmartSurface(const SmartSurface&);
    SmartSurface& operator=(const SmartSurface&);

    // Make the following two functions const when COW fixed
    SDL_Surface* operator->() const;

    bool operator!() const;

    bool operator==(const SmartSurface&);
    bool operator!=(const SmartSurface&);

    SDL_Surface* get() const;
    bool unique();

private:
    struct PointerData {

        explicit PointerData(SDL_Surface* ptr = 0, unsigned int ct = 1) : pointer(ptr), count(ct) { }

        SDL_Surface*		pointer;
        unsigned int		count;

    }	*pointer_data;

    void set(PointerData*);
    void release();


};	// class SmartSurface

#endif // __SIR_SMART_SURFACE_HH
